"use strict";function X(n){return new Date(+n-6e4*(new Date).getTimezoneOffset()).toJSON().slice(0,-5).replace("T"," ")}function Y(n,t){return t&&("omniBlockList"===n||u.d.Du([t]))?"$base64:"+btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(n,t){return String.fromCharCode(parseInt(t,16))})):t}function Z(n){return n instanceof Array&&(n=n.join("\n").trimRight()),(n=n.replace(/\r\n?/g,"\n")).replace(/^\$base64:(.*)/gm,function(n,t){try{return decodeURIComponent([].map.call(atob(t),function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(n){}return n})}function nn(n,e,i){var o,r,c,a,u,l,f,g,p,d,m,_,b,w,v,T=e.environment,h=T&&T.platform||"",y=T&&parseFloat(T.extension||0)||0,O=y>parseFloat(R.C.vn);if(h&&(h=(""+h).slice(0,10)),confirm(s("confirmImport",[s(true!==i?"backupFile":"recommendedFile"),y>1?s("fileVCVer").replace("*",""+y):"",(y>1?s("fileVCVer_2").replace("*",""+y):"")+(O?s("fileVCNewer"):""),h?s("filePlatform",[s(h)||h[0].toUpperCase()+h.slice(1)]):s("commonPlatform"),n?s("atTime",[X(n)]):s("before")]))){for(u in Object.setPrototypeOf(e,null),null==e.vimSync&&(r=(o=R.on("vimSync"))&&confirm(s("keepSyncing")),e.vimSync=r||null,o&&console.log("Before importing: You chose to",r?"keep settings synced.":"stop syncing settings.")),c=function(n,t,e,i){var o=arguments.length>3,r=o?i:e,s=["%s %c%s",n,"color:darkred",t];r="string"!=typeof r||r.length<=72?r:r.slice(0,71).trimRight()+"\u2026",o&&s.push(e),s.push(r),console.log.apply(console,s)},n>1e4?console.info("IMPORT settings saved at %c%s%c.","color:darkblue",X(n),"color:auto"):console.info("IMPORT settings:",i?"recommended.":"saved before."),(a=function(n){return n.split(" ").forEach(function(n){return delete e[n]})})("name time environment author description"),e)"@"===u[0]&&delete e[u];for(l=localStorage,f=R.rn,g=S.yu,p=l.length;0<=--p;)(u=l.key(p)).includes("|")||u in e||(e[u]=null);for(u in a("findModeRawQuery findModeRawQueryList innerCSS findCSS omniCSS newTabUrl_f hookAccessKeys vomnibarPage_f"),R.xn)u in e&&(e[R.xn[u]]=e[u],delete e[u]);for(m in e.vimSync!==R.on("vimSync")&&(c("import","vimSync",e.vimSync),R.sn("vimSync",e.vimSync),g.vimSync.ko()),void 0!==(d=g.keyMappings)&&(delete g.keyMappings,g.keyMappings=d),g)if(b=e[u=(_=g[m]).p],delete e[u],null==b?b=f[u]:("string"==typeof f[u]&&(b=Z(b)),b=_.Ro(b,"object"==typeof f[u])),_.Lo(R.on(u),b)){if(_.wo)continue;_.ko()}else c("import",u,b),R.sn(u,b),u in R.ln&&S.$o.push(u),_.ko(),_.xo&&_.xo();for(u in e)if(null!=(b=e[u]))"string"==typeof f[u]&&(b=Z(b)),u in f?R.on(u)!==b&&(R.sn(u,b),c("update",u,b)):(l.setItem(u,b),c("save",u,b));else{if(u in f){if(b=f[u],R.on(u)!==b){R.sn(u,b),c("reset",u,b);continue}b=R.on(u)}else b=l.getItem(u);l.removeItem(u),c("remove",u,":=",b)}t("#saveOptions").onclick(false),t("#advancedOptionsButton").getAttribute("aria-checked")!==""+R.on("showAdvancedOptions")&&t("#advancedOptionsButton").onclick(null,true),console.info("IMPORT settings: finished."),(v=(w=window.VApi&&VApi.y().r)&&w.querySelector("#HCls"))&&(v.click(),t("#showCommands").click()),window.VApi&&VApi.t({k:202})}else window.VApi&&VApi.t({k:201})}function tn(n,e,i){var o,r,c,a,l,f=null,g=null,p="";try{(o=en(i?e:e.replace(/\xa0/g," ")))instanceof Error?g=o:o?f=o:p=s("notJSON")}catch(n){g=n}return null!=g&&(p=(r=/^(\d+):(\d+)$/.exec(p=g?(g.message||g)+"":s("exc")+(""!==g?g:s("unknown"))))?s("JSONParseError",[r[1],r[2]]):p),f?(n=+new Date(f.time||("object"==typeof n?+n:n))||0,"Vimium C"!==f.name&&"Vimium++"!==f.name||n<1e4&&n>0?(p=s("notVCJSON"),alert(p)):(c=S.yu.keyMappings.So?1:new Promise(function(n){var e=t("script[src*=options_checker]")||C("options_checker.js"),i=function(){e.removeEventListener("load",i),n(1)};P.Yo="",e.addEventListener("load",i)}),a=n,l=f,void Promise.all([u.r.me("KeyMappings"),c]).then(function(){setTimeout(nn,17,a,l,i)}))):alert(p)}function en(n){function t(){return/a?/.test("")}function e(n){for(var t=n.length;o.length<t;o+=o);return o.slice(0,t)}var i,o,r,s,c,a,u,l=/[^\r\n]+/g;if(!n||!(n=n.trimRight()))return null;o=" ";try{return r=JSON.parse(n.replace(/"(?:\\[\\\"]|[^"])*"|'(?:\\[\\\']|[^'])*'|\/\/[^\r\n]*|\/\*[^]*?\*\/|#[^\r\n]*/g,function(n){var t=n[0];return"/"===t||"#"===t?n.startsWith("/*")?n.replace(l,e):e(n):n})),t(),r}catch(n){if(i=/\b(?:position (\d+)|line (\d+) column (\d+))/.exec(n+""),t(),!i||!i[0])throw n}return i[2]?(s=+i[2],c=+i[3]):+i[1]>0?(a=n.includes("\r")?n.includes("\r\n")?"\r\n":"\r":"\n",c=(u=n.slice(0,+i[1]).split(a))[(s=u.length)-1].length+1):s=c=1,new SyntaxError(s+":"+c)}var on,rn;t("#showCommands").onclick=function n(t){var e,i,o;if(window.VApi&&VApi.z){if(i=VApi.y().r,t&&t.preventDefault(),i&&(e=i.querySelector("#HCls"))&&(o=null!=i.querySelector(".HelpCommandName"),q(e),o))return;VApi.p({H:12}),t||setTimeout(function(){var n=VApi.y(),t=n.r&&n.r.querySelector("#HDlg");t&&t.querySelector("#HCls").addEventListener("click",function(){location.hash=""},true)},100)}else"undefined"!=typeof VimiumInjector&&setTimeout(n,120,null)},_.prototype.Ss=function(n){var t,e,i,o,r,c,a,u,l;if(!n||!this.dr){for(e=/^([:^]?[a-z\-?*]+:\/\/)?((?:[^\/]|\/])+)(\/[^\]].*|\/?$)/,i=/\\\./g,c=0,a=t=this.Ao();c<a.length;c++)(r=e.exec(o=(u=a[c]).pattern.replace("(?:[^./]+\\.)*?","*.")))&&r[1]&&r[2]&&(o=r[3]?r[3].replace(i,"."):"",(r=r[2].replace(i,".").split(".")).reverse(),o=r.join(".")+o),u.oo=o;t.sort(function(n,t){return n.oo<t.oo?-1:n.oo===t.oo?0:1}),this.No(t),this.ho(),n&&(l=this,this.dr=setTimeout(function(n,t){n.firstChild.data=t,l.dr=0},1e3,n,n.firstChild.data),n.firstChild.data=s("o3_2"))}},t("#exclusionSortButton").onclick=function(){S.yu.exclusionRules.Ss(this)},on="",window.addEventListener("unload",function(){on&&URL.revokeObjectURL(on)}),t("#exportButton").onclick=function(n){var t,e,i,o,r,s,c,a,u,l,f,g,p,d,m,_,S;for(on&&(URL.revokeObjectURL(on),on=""),e=!!n&&(n.ctrlKey||n.metaKey||n.shiftKey),i=new Date,(t=Object.create(null)).name="Vimium C",e||(t["@time"]=i.toLocaleString(),t.time=i.getTime()),t.environment={extension:R.C.vn,platform:R.C.An},t.environment.chrome=N,o=[],r=localStorage,s=R.rn,c=0,a=r.length;c<a;c++)(u=r.key(c)).includes("|")||u.endsWith("_f")||"findModeRawQueryList"===u||u.endsWith("CSS")||o.push(u);for(o.sort(),l=function(n){var e=r.getItem(n);"string"!=typeof s[n]?t[n]=n in s?R.on(n):e:e.includes("\n")?(t[n]=e.split("\n")).push(""):t[n]=e,"string"==typeof s[n]&&(t[n]="string"==typeof t[n]?Y(n,t[n]):t[n].map(function(t){return Y(n,t)}))},f=0,g=o;f<g.length;f++)l(u=g[f]);p=JSON.stringify(t,null,"\t")+"\n",d=X(i),"win"===t.environment.platform&&(p=p.replace(/\n/g,"\r\n")),t=null,m="vimium_c-",m+=e?"settings":d.replace(/[\-:]/g,"").replace(" ","_"),m+=".json",_=new Blob([p],{type:"application/json",endings:"native"}),(S=document.createElement("a")).download=m,S.href=URL.createObjectURL(_),q(S),on=S.href,console.info("EXPORT settings to %c%s%c at %c%s%c.","color:darkred",m,"color:auto","color:darkblue",d,"color:auto")},(rn=t("#settingsFile")).onclick=null,rn.onchange=function(){var n,t,e,i=this.files[0];this.value="",i&&(n=S.yu.vimSync.fo?102400:10485760,i.size&&i.size>n?alert(s("JSONTooLarge",[i.name,n/1024])):(t=new FileReader,e=i.lastModified||i.lastModifiedDate||0,t.onload=function(){return tn(e,this.result,false)},t.readAsText(i)))},(rn=t("#importOptions")).onclick=null,rn.onchange=function(){t("#importButton").focus(),"exported"!==this.value?fetch("../settings-template.json").then(function(n){return n.text()}).then(function(n){return tn(0,n,true)}):q(t("#settingsFile"))},rn=null,window.ws&&(function(){var n,e=window.ws;delete window.ws,(n=t(e[0])).onclick&&n.onclick(e[1])})();