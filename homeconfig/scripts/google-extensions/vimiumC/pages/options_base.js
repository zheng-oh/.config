"use strict";var t,u,s,p,w,y,x,O,N,R,S,_,J;t=function(t){return document.querySelector(t)},u=chrome.extension.getBackgroundPage(),s=chrome.i18n.getMessage,p=function(t,n){return(n||document).querySelectorAll(t)},(w=chrome.i18n.getMessage("lang1"))&&(function(){var n,i,e,o,u,r,c,a,f=navigator.language||s("lang2"),l=s("keyMappingsP"),h=t("#keyMappings");for(l&&h&&(h.placeholder=l),n=0,i=p("[data-i-t]");n<i.length;n++)(l=s((h=i[n]).dataset.iT))&&(h.title=l);if(f&&("zh"!==w||"zh-CN"!==f))for(e=0,o=p("input[type=text], textarea");e<o.length;e++)(h=o[e]).lang=f;for(u=0,r=p("[data-i]");u<r.length;u++)((l=s(a=(c=(h=r[u]).dataset).i))||"NS"===a||c.iE)&&(h.innerText=l);document.documentElement.lang="zh"===w?"zh-CN":w})(),y=function(t,n){var i=function(){this.constructor=t};i.prototype=n.prototype,t.prototype=new i},x=(function(){var t=[],n=function(){var i,e,o=t.length;for(i=0,e=t;i<e.length;i++)(0,e[i])();t.length>o?(t.splice(0,o),Promise.resolve().then(n)):t.length=0};return function(i,e){t.length<=0&&Promise.resolve().then(n),9===e?t.unshift(i):t.push(e?i.bind(null,e):i)}})(),O=function(t,n,i,e){var o,u=0,r=function(){var s=Date.now()-o;if(!(s<n-4&&s>=0))return u=0,o!==e?t.call(i):void 0;u=setTimeout(r,n-s)};return e=e?1:0,function(){if(o=Date.now(),!u)return u=setTimeout(r,n),e?(e=o,t.call(i)):void 0}},N=u.f,R=u.l,S=(function(){function t(t,n){this.Ht=t,this.p=t.id,this.fo=this.ho=null,this.wo=false,this.p in R.ln&&(n=this.yo.bind(this,n)),this.ho=O(n,330,this,1)}return t.prototype.xo=function(){},t.prototype.ko=function(){this.wo=true,this.fo=R.on(this.p),t.Oo||this.No(this.fo)},t.prototype.Ro=function(t,n,i){var e=this.So;return n?(i=e||!i?JSON.stringify(e?e._o(t):t):i,u.JSON.parse(i)):e?e._o(t):t},t.prototype.Jo=function(){return true},t.prototype.zo=function(){var n=this.Ao(),i="object"==typeof n,e=i?JSON.stringify(this.fo):this.fo,o=i?JSON.stringify(n):n;o!==e&&(e=o,n=this.Ro(n,i,i?o:""),i&&(o=JSON.stringify(n))===JSON.stringify(R.rn[this.p])&&(n=R.rn[this.p]),R.sn(this.p,n),this.fo=n=R.on(this.p),this.wo=true,(e!==(i?JSON.stringify(n):n)||this.Po(n))&&this.No(n,true),this.p in R.ln&&t.$o.push(this.p),this.xo())},t.prototype.Po=function(){return false},t.jo=function(t,n){return JSON.stringify(t)===JSON.stringify(n)},t.Oo=true,t})(),_=(function(n){function i(e,o){var u,r,c,a,f,l,h=n.call(this,e,o)||this;if(h.Lo=S.jo,h.o=e.querySelector("#exclusionTemplate").content.querySelector(".exclusionRule"),w){for(u=void 0,r=void 0,c=0,a=p("[data-i]",e);c<a.length;c++)(r=s((u=a[c]).dataset.i))&&(u.innerText=r);for(f=0,l=p("[title]",h.o);f<l.length;f++)(r=(u=l[f]).title)?(r=s(r))&&(u.title=r):(r=s(u.getAttribute("title")))&&u.setAttribute("title",r)}return h.Ko=e.querySelector("tbody"),h.fr=[],h.Ko.addEventListener("input",i.Do),h.Ko.addEventListener("input",h.ho),h.Ko.addEventListener("click",function(t){return h.Uo(t)}),t("#exclusionAddButton").onclick=function(){return h.Co("")},S.$o&&(h.o.draggable=true),x(function(){return h.Eo&&h.Eo()}),h}return y(i,n),i.prototype.Mo=function(){},i.Do=function(t){var n=t.target.vnode;n&&(n.Wo=true)},i.prototype.Co=function(t,n){this.Zo(this.Ko,{pattern:t,passKeys:""});var i=this.fr[this.fr.length-1];false!==n&&x(function(){return i.Bo.focus()}),t&&this.ho(),this.Mo(1)},i.prototype.No=function(t){if(this.Ko.textContent="",this.fr=[],t.length<=0);else if(1===t.length)this.Zo(this.Ko,t[0]);else{var n=document.createDocumentFragment();t.forEach(this.Zo.bind(this,n)),this.Ko.appendChild(n)}return this.Mo(t.length)},i.prototype.Fo=function(){return true},i.prototype.Zo=function(t,n){var i,e,o,u,r,s=n.pattern,c=n.passKeys,a={Io:{pattern:s,passKeys:c},Wo:false,Kr:false,Bo:null,qo:null};this.Fo(s)?(e=(i=document.importNode(this.o,true)).querySelector(".pattern"),o=i.querySelector(".passKeys"),u=c.trimRight(),e.value=s,s&&(e.placeholder=""),o.value=u,u&&(o.placeholder=""),(r=a).Kr=true,r.Bo=e,r.qo=o,e.vnode=r,o.vnode=r,this.fr.push(r),t.appendChild(i)):this.fr.push(a)},i.Go=function(t){t.Io.pattern&&t.qo.placeholder&&(t.qo.placeholder="")},i.prototype.Uo=function(t){var n,i=t.target;if("path"===i.localName&&(i=i.parentElement),i.classList.contains("remove"))return(i=i.parentNode.parentNode).classList.contains("exclusionRule")?(n=i.querySelector(".pattern").vnode,i.remove(),this.fr.splice(this.fr.indexOf(n),1),this.ho(),this.Mo(0)):void 0},i.Ho=function(t,n,i){var e=i.toLowerCase();return i!==e?"<"+n+"s-"+e+">":t},i.Qo=function(t){return t&&t.replace(/<(?!<)((?:[acm]-){0,3})([^a-z\d][\dA-Z]*)>/g,i.Ho)},i.prototype.Ao=function(t){var n,e,o,u,r,s,c,a,f,l,h=[];for(t=true===t,n=0,e=this.fr;n<e.length;n++)o=e[n],t&&!o.Kr||(o.Wo?(u=o.Bo.value.trim(),r=false,s=o.qo.value,u?((c=u.startsWith(":")?0:u.indexOf("://"))&&(/^[\^*]|[^\\][$()*+?\[\]{|}]/.test(u)?u.startsWith("^")||(r=!u.includes("/",c+3),u=(c<0?"^https?://":"^")+(u.startsWith("*")&&"."!==u[1]?"[^/]"+u:(u=u.replace(/\./g,"\\.")).startsWith("*")?u.replace("*\\.","(?:[^./]+\\.)*?"):u.replace("://*\\.","://(?:[^./]+\\.)*?"))):(r=!u.includes("/",c+3)&&!u.startsWith("vimium:"),u=(c<0?":http://":":")+(u=u.replace(/\\(.)/g,"$1")))),r&&(u+="/"),s&&((a=(s=i.Qo(s)).match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z][\da-z]+|[^\sA-Z])>|\S/g))&&((f="^"===a[0]&&a.length>1)&&a.shift(),a.sort(),f?a.unshift("^"):"^"===a[0]&&(a.shift(),a.push("^"))),s=(s=a?a.join(" ")+" ":"").replace(/<escape>/gi,"<esc>")),o.qo.title!==(l=s?s.length>1&&"^"===s[0]?"only hook such keys":"pass through such keys":"completely disabled")&&(o.qo.title=l),this.Vo(o,u,s),h.push(o.Io)):this.Vo(o,"",s)):o.Io.pattern&&h.push(o.Io));return h},i.prototype.Vo=function(t,n,e){var o=!t.Io.passKeys&&!!e;t.Io={pattern:n,passKeys:e},t.Wo=false,o&&i.Go(t)},i.prototype.xo=function(){var t,n,i,e;for(t=0,n=this.fr;t<n.length;t++)(i=n[t]).Kr&&(i.Bo.value!==i.Io.pattern&&(i.Bo.value=i.Io.pattern),e=i.Io.passKeys.trim(),i.qo.value!==e&&(i.qo.value=e))},i})(S),J=N<48||devicePixelRatio<2&&N>=61?function(){var t=document.createElement("style"),n=devicePixelRatio,i=N>=61&&n>=1,e=i||N>=48?1/n:1;e=(""+(e+=999e-8)).slice(0,7).replace(/\.?0+$/,""),t.textContent=i?"html { --tiny: "+e+"px; }":"* { border-width: "+e+"px !important; }",document.head.appendChild(t)}:null,location.pathname.toLowerCase().includes("/popup.html")&&Promise.resolve((u.r.Fe(1),R.zn&&R.zn())).then((function(t){return function(){chrome.tabs.query({currentWindow:true,active:true},t)}})(function(n){function i(t){var n,i,e=3===j,o=e?p.tt(z,w):p.st(z,w,Z.Ao(true));o&&(o=(function(t){var n,i,e,o;for((n=(t=t.trim()).length>2&&t.startsWith("^"))&&(t=t.slice(1).trimLeft()),i=Object.create(null),e=0,o=t.split(" ");e<o.length;e++)i[o[e]]=1;return(n?"^ ":"")+Object.keys(i).sort().join(" ")})(o)),t&&(P=j>=2?o:null),j=2,n=o===P,i=!!o&&o.length>2&&"^"===o[0],k.textContent=(e?o?s("o137")+s(i?"o138":"o139"):s("o140"):s(n?"o141":"o142")+s(o?i?"o138":"o139":n?"o143":"o143_2")).replace(" to be","")+s("colon")+(o?s("NS"):""),b.className=o?"code":"fixed-width",b.textContent=o?i?o.slice(2):o:s(null!==o?"o144":"o145")+s("o146"),N.textContent=M&&!e&&n?s("o147",[s(0!==$?"o144":"o145")]):M?s("o148"):"",O.disabled=n,O.firstChild.data=s(n?"o115":"o115_2")}function e(){if(!O.disabled){var t=p.Vn;u.a.ht("reset silent",w.t),Z.zo(),setTimeout(function(){p.Vn=t,setTimeout(W,150)},50),j=3,i(true),O.firstChild.data=s("o115_3"),O.disabled=true,A=true}}function o(t,n){n&&n.preventDefault(),u.a.ht(t.toLowerCase(),w.t),window.close()}var r,c,a,f,l,h,d,v,m,p,w,g,k,O,b,N,z,T,A,P,$,j,L,K,D,U,C,E,M,W,Z,B=n[0],F=B.url,I=u.a.gn(B.id),q=t("#blocked-msg"),G=!(I||B&&F&&"loading"===B.status&&/^(ht|s?f)tp/.test(F));if(G?(r=document.body,c=document.documentElement,r.innerText="",q.style.display="",q.querySelector(".version").textContent=R.C.Cn,a=q.querySelector("#refresh-after-install"),B&&F&&/^(ht|s?f)tp/i.test(F)||a.remove(),r.style.width="auto",r.appendChild(q),null==(l=(f=F.startsWith(location.protocol)&&!F.startsWith(location.origin)?new URL(F).host:"")?R.tn.get(f):null)||l||((h=t("#injection-refused")).style.display="",h.nextElementSibling.remove(),t("#doAllowExt").onclick=function(){var t,n=R.on("extAllowList"),i=n.split("\n"),e=f;i.indexOf(e)<0&&(t=i.indexOf("# "+e)+1||i.indexOf("#"+e)+1,i.splice(t?t-1:i.length,t?1:0,e),n=i.join("\n"),R.sn("extAllowList",n)),this.onclick=null,chrome.tabs.query({active:true,currentWindow:true},function(t){var n=function(){return setTimeout(function(){return location.reload()},500),chrome.runtime.lastError};return t&&t[0]?chrome.tabs.reload(t[0].id,n):chrome.tabs.reload(n),chrome.runtime.lastError})}),c.classList.toggle("auto-dark",!!R.Xe.d),c.style.height=""):x(function(t){q.remove(),q=null;var n=document.documentElement.classList;n.toggle("auto-dark",!!R.Xe.d),n.toggle("less-motion",!!R.Xe.m),t.textContent=R.C.Cn},t(".version")),d=t(".options-link"),F.startsWith(v=R.C.Nn)?(d.nextElementSibling.remove(),d.remove()):(d.href!==v&&(d.href=v),d.onclick=function(t){t.preventDefault();var n=u.Object.create(null);n.u=R.C.Nn,u.a.ot[19](n),window.close()}),G)return m=t("#retryInject"),void(/^(file|ftps?|https?):/.test(F)?m.onclick=function(t){var n,i,e,o;if(t.preventDefault(),!u.a.gn(B.id))for(n=location.origin.length,i=function(){},e=0,o=R.C.Un;e<o.length;e++)chrome.tabs.executeScript(B.id,{file:o[e].slice(n),allFrames:true},i);window.close()}:(m.nextElementSibling.remove(),m.remove()));for(p=u.Exclusions,w=!I||I[0].s.i&&!u.r.D.test(I[0].s.u)?{i:0,a:B.incognito,s:0,f:0,t:B.id,u:F}:I[0].s,g=w.i&&((u.a.gn(B.id,0)||{}).s||{}).u||"",k=t("#state-action"),O=t("#saveOptions"),N=(b=k.nextElementSibling).nextElementSibling,z=w.u,T=(function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return y(n,t),n.prototype.Co=function(i,e){t.prototype.Co.call(this,n.Xo(),e)},n.prototype.Fo=function(t){if(!t)return false;var n=p.Vn.get(t);return!(1===n.t?!z.startsWith(n.v)||g&&!g.startsWith(n.v):!n.v.test(z)||g&&!n.v.test(g))},n.prototype.No=function(e){var o,u,r,s;t.prototype.No.call(this,e),(o=this).No=null,document.documentElement.style.height="",n.prototype.Fo=_.prototype.Fo,u=o.fr.filter(function(t){return t.Kr}),j=(r=u.length>0)?2:1,r?(s=u[0].qo,i(true)):(o.Co("",false),s=o.fr[o.fr.length-1].qo),x(function(){return s.focus()})},n.prototype.Vo=function(n,i,e){var o,u,r=n.Io.pattern===i;t.prototype.Vo.call(this,n,i,e),r||(o=p.Kn(i,""),u=n.Bo,(1===o.t?z.startsWith(o.v):o.v.test(z))?u.title=u.style.color="":(u.style.color="red",u.title="Red text means that the pattern does not\nmatch the current URL."))},n.Xo=function(){var t=z.startsWith("http:")?"^https?://"+z.split("/",3)[2].replace(/[.[\]]/g,"\\$&")+"/":z.startsWith(location.origin)?":vimium:/"+new URL(z).pathname.replace("/pages",""):/^[^:]+:\/\/./.test(z)&&!z.startsWith("file:")?":"+z.split("/",3).join("/")+"/":":"+z;return n.Xo=function(){return t},t},n})(_),A=true,P=null,$=-1,j=0,O.onclick=e,document.addEventListener("keyup",function(t){13===t.keyCode&&(t.ctrlKey||t.metaKey)&&(setTimeout(window.close,300),A||e())}),L=R.on("exclusionRules"),K=p.Vn=new u.Map,D=p.Wn,U=0,C=L.length;U<C;U++)K.set(L[U].pattern,D[U]);(W=function(){E=2!==w.s?"Disable":"Enable",$=(M=!!(1&w.f))?w.s:-1;var n=t("#toggleOnce"),i=n.nextElementSibling;x(function(){n.firstElementChild.textContent=(s(E)||E)+(M?"":s("Once")),n.onclick=o.bind(null,E),b.id="state-value",i.classList.toggle("hidden",!M),M&&(i.firstElementChild.onclick=o.bind(null,"Reset"))})})(),R.Xe.o||window.addEventListener("keydown",function(t){t.altKey&&(88===t.keyCode||M&&90===t.keyCode)&&!(t.shiftKey||t.ctrlKey||t.metaKey)&&(t.preventDefault(),t.stopImmediatePropagation(),o(88===t.keyCode?E:"Reset"))}),S.Oo=false,Z=null,(Z=new T(t("#exclusionRules"),function(){if(A){A=false;var n=t("#helpSpan");n&&(n.nextElementSibling.style.display="",n.remove()),O.removeAttribute("disabled"),O.firstChild.data=s("o115_2")}i(j<2)})).ko(),window.onunload=function(){p.Vn=null,u.r.Fe(-1)},J&&x(J)}));