"use strict";var e={g:function(n,t){return"vimiumContent|"+n+(t?"|"+t:"")},Xt:function(t,e){var o=chrome.contentSettings;return o?o[t]&&!/^[A-Z]/.test(t)&&o[t].get?!(!e.startsWith("read:")&&r.D.test(e)&&!e.startsWith(v))&&(a.Xt(n("changeItsCS")),true):(a.Yt(n("unknownCS",[t])),true):(a.Yt("This version of Vimium C has no permissions to set CSs"),true)},m:function(t,e){var o,i,c,u,l,s,_,g,d,m;if(t.startsWith("file:"))return(o=f>=56?1:e>1?2:0)?(a.Xt(1===o?n("setFileCS",[56]):n("setFolderCS")),[]):[t.split(/[?#]/,1)[0]];if(t.startsWith("ftp:"))return a.Xt(n("setFTPCS")),[];if(i=t.match(/^([^:]+:\/\/)([^\/]+)/),c=r.A.exec(i[2]),u=[(t=i[1])+(l=c[3]+(c[4]||""))+"/*"],e<2||r.W(c[3],0))return u;for(c=null,_=(s=r.oe(l))[0],g=s[1],d=Math.min(_.length-g,e-1),m=0;m<d;m++)l=l.slice(_[m].length+1),u.push(t+l+"/*");return u.push(t+"*."+l+"/*"),d===_.length-g&&"http://"===t&&u.push("https://*."+l+"/*"),u},v:function(n){var t,e,r=n.length;do{e=new URL(n[--r].s.u).host,t||(t=e)}while(1<r&&e===t);return e!==t},k:function(n,t){var o=chrome.contentSettings,i=o&&o[n];i&&i.clear&&(null==t?(i.clear({scope:"regular"}),i.clear({scope:"incognito_session_only"},r.x),localStorage.removeItem(e.g(n))):i.clear({scope:t?"incognito_session_only":"regular"}))},Ot:function(t,r){var o=""+t.type;if(!e.Xt(o,"http://a.cc/"))return e.k(o,r?r.s.a:2===m.ft),a.Yt(n("csCleared",[n(o)||o]))},Kt:function(n,t,r){var o=""+n.type,i=r[0];return n.incognito?e.tr(t,o,i):e.er(o,t,i,"reopen"===n.action)},er:function(n,t,o,i){var c=r.te(o.url);e.Xt(n,c)||chrome.contentSettings[n].get({primaryUrl:c,incognito:o.incognito},function(u){e.rr(n,c,t,{scope:o.incognito?"incognito_session_only":"regular",setting:u&&"allow"===u.setting?"block":"allow"},function(t){var c,u,l;if(!t)return o.incognito||(c=e.g(n),"1"!==localStorage.getItem(c)&&localStorage.setItem(c,"1")),l=f>=70&&(u=a.gn(o.id))&&u.length>2&&e.v(u),o.incognito||i?(++o.index,a.jt(o)):o.index>0?a.jt(o,l?0:2):void chrome.windows.getCurrent({populate:true},function(n){return n&&"normal"===n.type?a.jt(o,l?0:n.tabs.length>1?2:1):chrome.tabs.reload(r.x),r.x()})})})},tr:function(n,t,o){if(l.C.qn)return a.Xt("setIncogCS");var i=r.te(o.url);e.Xt(t,i)||chrome.contentSettings[t].get({primaryUrl:i,incognito:true},function(c){return r.x()?(chrome.contentSettings[t].get({primaryUrl:i},function(r){r&&"allow"===r.setting||chrome.windows.create({type:"normal",incognito:true,focused:false,url:"about:blank"},function(r){var c=r.tabs[0].id;return e.or(n,t,o,i,r.id,true,function(){chrome.tabs.remove(c)})})}),r.x()):c&&"allow"===c.setting&&o.incognito?e.ir(o):void chrome.windows.getAll(function(r){if((r=r.filter(function(n){return n.incognito&&"normal"===n.type})).length){if(c&&"allow"===c.setting)return e.ir(o,r[r.length-1].id);var a=o.windowId,u=o.incognito&&r.some(function(n){return n.id===a});return e.or(n,t,o,i,u?void 0:r[r.length-1].id)}console.log("%cContentSettings.ensure","color:red","get incognito content settings",c," but can not find an incognito window.")})})},or:function(n,t,r,o,i,c,a){var u=e.cr.bind(null,r,i,a);return e.rr(t,o,n,{scope:"incognito_session_only",setting:"allow"},c&&i!==r.windowId?function(n){if(n)return u(n);chrome.windows.get(r.windowId,u)}:u)},rr:function(n,t,o,i,c){var a,u,l,s,_=false,f=chrome.contentSettings[n],g=function(){var n=r.x();return n&&console.log("[%o]",Date.now(),n),_||(--m,((_=!!n)||0===m)&&setTimeout(c,0,_)),n},d=e.m(t,0|o),m=d.length;if(m<=0)return c(true);for(r.T(i),a=0,u=d;a<u.length;a++)l=u[a],(s=r.r(r.L(),i)).primaryPattern=l,f.set(s,g)},cr:function(n,t,r,o){true!==o&&e.ir(n,t),r&&r(),true!==o&&t&&chrome.windows.update(t,{focused:true,state:o?o.state:void 0})},ir:function(n,t){n.active=true,"number"!=typeof t||n.windowId===t?++n.index:(n.index=void 0,n.windowId=t),a.jt(n)}},j={ce:localStorage,ar:null,sn:function(n,t,e){var r,o,c,a=n.l,u=n.n,l=n.u,s=n.s;a&&0===s[0]&&0===s[1]&&(2===s.length?(r=l.indexOf("#"))>0&&r<l.length-1&&s.push(l.slice(r)):(s[2]||"").length<2&&s.pop()),o=j.ur(u,a?l:""),c=JSON.stringify(a?s:{tabId:e,url:l,scroll:s}),t?(j.ar||(i.lr(),j.ar=new Map)).set(o,c):j.ce.setItem(o,c)},sr:function(n,t){n.postMessage({N:10,H:null,c:4,n:1,a:t})},Jt:function(n,t){var e=t.s.t;n.s?j.sn(n,t.s.a,e):(t=a.gn(e,0)||t)&&t.postMessage({N:11,n:n.n})},Qt:function(t,e){var o,i,c,u,l,s,_,f=t.l,g=t.n,d=j.ur(g,f?t.u:""),m=e.s.a&&j.ar&&j.ar.get(d)||j.ce.getItem(d);return f&&((o=m?JSON.parse(m):null)||(c=void 0,u=void 0,(i=t.o)&&(c=+i.x)>=0&&(u=+i.y)>=0&&(t.s=o=[c,u,i.h])),o)?j.sr(e,{n:g,s:o,l:2}):m?(s=+(l=JSON.parse(m)).tabId,(_={u:l.url,s:l.scroll,t:l.tabId,n:g,p:true}).p=false!==t.p&&0===_.s[1]&&0===_.s[0]&&!!r.Te(_.u),s>=0&&a.gn(s)?void chrome.tabs.get(s,j._r.bind(0,_)):a.ot[19](_)):a.Yt(n("noMark",[n(f?"Local_":"Global_"),g]))},_r:function(n,t){var e=(t.url||t.pendingUrl).split("#",1)[0];return e===n.u||n.p&&n.u.startsWith(e)?(a.ot[5]({s:t.id}),j.kt(n,t)):a.ot[19](n)},ur:function(n,t){return t?"vimiumMark|"+r.Le(t.split("#",1)[0])+(t.length>1?"|"+n:""):"vimiumGlobalMark|"+n},kt:function(n,t){var e=t.id,r=a.gn(e,0);if(r&&j.sr(r,{n:n.n,s:n.s,l:0}),n.t!==e&&n.n)return j.sn(n,2===m.ft,e)},qt:function(t){var e,r,o,i,c,u,l,s=j.ur("",t),_=[],f=j.ce;for(e=0,r=f.length;e<r;e++)(o=f.key(e)).startsWith(s)&&_.push(o);for(i=0,c=_;i<c.length;i++)f.removeItem(o=c[i]);return u=_.length,(l=j.ar)&&l.forEach(function(n,t){t.startsWith(s)&&(u++,l.delete(t))}),a.Yt(n("markRemoved",[u,n(t?"#"===t?"allLocal":"41":"39"),n(1!==u?"have":"has")]))}},h={oo:"findModeRawQueryList",fr:null,gr:null,dr:0,mr:function(){var n=l.on(h.oo);h.fr=n?n.split("\n"):[],h.mr=null},Ct:function(n,t,e){var o,c,a=h;return a.mr&&a.mr(),o=n?a.gr||(i.lr(),a.gr=a.fr.slice(0)):a.fr,t?(t=t.replace(/\n/g," "),n?a.vr(t,o,true):((c=a.vr(t=r.S(t,0,99),o))&&l.sn(a.oo,c),a.gr?a.vr(t,a.gr,true):void 0)):o[o.length-(e||1)]||""},vr:function(n,t,e){var r=t.lastIndexOf(n);if(r>=0){if(r===t.length-1)return;t.splice(r,1)}else t.length>=50&&t.shift();if(t.push(n),!e)return t.join("\n")},Lt:function(n){n?h.gr&&(h.gr=[]):(h.mr=null,h.fr=[],l.sn(h.oo,""))}},i={hr:false,dr:0,lr:function(){i.hr||(chrome.windows.onRemoved.addListener(i.Br),i.hr=true)},Br:function(){i.hr&&(i.dr=i.dr||setTimeout(i.kr,34))},kr:function(){var n,t,e;if(i.dr=0,f>=52){for(e in n=false,t=a.gn())if(t[+e][0].s.a){n=true;break}if(n)return}chrome.windows.getAll(function(n){n.some(function(n){return n.incognito})||i.pr()})},pr:function(){h.gr=null,j.ar=null,chrome.windows.onRemoved.removeListener(i.Br),i.hr=false}},k={Cr:[f>=74?2:0,f>=76?2:0],Sr:0,on:function(n){var t=k.Cr[n];return"object"==typeof t?t.matches:null},Ur:function(n,t){var e,r=k,o=r.Cr,i=o[n],c=n?"prefers-color-scheme":"prefers-reduced-motion";1===i&&t&&(o[n]=i=matchMedia("("+c+")").matches?2:0),t&&2===i?((e=matchMedia("("+c+": "+(n?"dark":"reduce")+")")).onchange=r.br,o[n]=e,r.Sr||f<1e3&&(r.Sr=setInterval(k.wr,6e4)),r.yr(n,0)):t||"object"!=typeof i||(i.onchange=null,o[n]=2,r.Sr>0&&(o.some(function(n){return"object"==typeof n})||(clearInterval(r.Sr),r.Sr=0)),r.yr(n,0))},yr:function(n,t){var e,r,o,i,c,u,s=k.Cr[n];r=(e=l).Xe,o=n?"dark":"less-motion",u=e.un(c=n?"d":"m",i=!!("object"==typeof s)&&s.matches),r[c]!==u&&(r[c]=u,t||e.hn({N:6,d:[c]})),a.ot[25]({t:o,e:i||(" "+e.ce.vomnibarOptions.styles+" ").includes(" "+o+" "),b:!t})},wr:function(){var n,t;for(t=(n=k.Cr).length;0<=--t;)"object"==typeof n[t]&&k.yr(t)},br:function(){k.Sr>0&&clearInterval(k.Sr),k.Sr=-1;var n=k.Cr.indexOf(this);n>=0&&k.yr(n)}},m={zt:new Map,vt:chrome.tabs.TAB_ID_NONE||-1,ut:chrome.windows.WINDOW_ID_NONE||-1,yt:-1,ft:1,Ft:null};r.Ae(120,function(){function n(n){var t=performance.now();t-f>666&&(u.set(m.vt,{i:++_,t:1===l.Xe.o?Date.now():t}),_>=2047&&(u.forEach(function(n,t){n.i<1025?u.delete(t):n.i-=1024}),_=1024)),m.vt=n.tabId,f=t}function t(t){if(!t||!t[0])return r.x();var e=t[0],o=e.windowId,i=m.ut;return o!==i&&(m.ut=o,m.yt=i),m.ft=e.incognito?2:1,d.Ir(),n({tabId:e.id})}var o,i,c,a,u=m.zt,s=m.ut,_=1,f=0;for(chrome.tabs.onActivated.addListener(n),chrome.windows.onFocusChanged.addListener(function(n){n!==s&&chrome.tabs.query({windowId:n,active:true},t)}),chrome.tabs.query({currentWindow:true,active:true},function(n){f=performance.now();var t=n&&n[0];if(!t)return r.x();m.vt=t.id,m.ut=t.windowId,m.ft=t.incognito?2:1}),m.Ft=function(n,t){return u.get(t.id).i-u.get(n.id).i},(o=l).mn.autoDarkMode=o.mn.autoReduceMotion=function(n,t){k.Ur(t.length>12?0:1,n)},o.pn("autoDarkMode"),o.pn("autoReduceMotion"),o.bn=k.yr,o.wn=k.wr,i=0,c=["images","plugins","javascript","cookies"];i<c.length;i++)a=c[i],null!=localStorage.getItem(e.g(a))&&setTimeout(e.k,100,a)}),l.De.Qe=function(){var t,e,r;for(l.De.Qe=null,t=l.nn=[],e=["$1","$2","$3","$4"],r=0;r<118;r++)t.push(n(""+r,e))},l.De.Ve|=2,a.Bn(),chrome.extension.isAllowedIncognitoAccess(function(n){l.C.qn=false===n});